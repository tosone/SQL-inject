(function(a,e,g){var c=null;var f=null;var n=null;var p=null,i={runtimeStep:500,autoStartListen:false,evts:{empty:null}};var m=null;var j=null;c={each:function(u,s){if(e.isPlainObject(u)){for(var r in u){if(s(r,u[r])===false){break}}}else{if(e.isArray(u)){for(var q=0,t=u.length;q<t;q++){if(s(q,u[q])===false){break}}}}},Interval:function(r,s,q){setTimeout(function(){if(r()!==false){c.Interval(r,s)}},s);if(q===true){r()}},readData:function(v){var w,r,t,u={};r=Sttdecode(v);for(var s=0,q=r.length;s<q;s++){w=r[s];u[w.name]=w.value}return u}};f={emptyFn:function(){},emptyArr:[],emptyObj:{},nodeType:{gift:"gift",peck:"peck"},nodeStatus:{birth:"birth",render:"render",live:"live",destroy:"destroy",heart:"heart"},nodeBehavior:{render:"render",destroy:"destroy",heart:"heart"},listenStatus:{die:"die",live:"live"}};n={isIE:navigator.appVersion.indexOf("MSIE")>0||navigator.appVersion.indexOf("Trident/7.0")>0,isIE7:navigator.appVersion.indexOf("MSIE 7.0;")>0,isFF:navigator.userAgent.indexOf("Firefox")>0};p=function(q){this.init(q)};p.create=function(q){return new p(q)};e.extend(true,p.prototype,{init:function(q){this.config=e.extend(true,i,q||{});this.config.queue=[];this.config.listenStatus=f.listenStatus.die;if(this.config.autoStartListen){this._startListen()}},add:function(q){this.config.queue.push(q);this._execNodeBehavior(q,f.nodeBehavior.render,{status:f.nodeStatus.birth,index:this.config.queue.length,node:q,timeline:this});return true},update:function(r){var t=this,q,s=this._getNodeId(r);c.each(this.config.queue,function(u,v){if(s===v.id){q=u;return false}});if(q===undefined){return false}t.config.queue[q]=r;this._execNodeBehavior(t.config.queue[q],f.nodeBehavior.render,{status:f.nodeStatus.render,index:q,node:t.config.queue[q],timeline:this});return true},heart:function(s,r){var u=this,q,t=this._getNodeId(s);c.each(this.config.queue,function(v,w){if(t===w.id){q=v;return false}});if(q===undefined){return false}this._execNodeBehavior(u.config.queue[q],f.nodeBehavior.heart,{status:f.nodeStatus.heart,index:q,node:u.config.queue[q],now:r,timeline:this});return true},destroy:function(r){var t=this,s=this._getNodeId(r),q;c.each(this.config.queue,function(u,v){if(s===v.id){q=u;t.config.queue[q].__status=f.nodeStatus.destroy;return false}});if(q===undefined){return false}this._execNodeBehavior(t.config.queue[q],f.nodeBehavior.destroy,{status:f.nodeStatus.destroy,index:q,node:t.config.queue[q],timeline:this},function(){t.remove(r)})},remove:function(r){var s=this._getNodeId(r),q=[];c.each(this.config.queue,function(t,u){if(s!==u.id){q.push(u)}});this.config.queue=q},clear:function(r){if(!r){this.config.queue=[]}var s=[],t="",q=[];c.each(r,function(u,v){s.push(v.id)});t=s.join("-");c.each(this.config.queue,function(u,v){if(t.indexOf(v.id)<0){q.push(v)}});this.config.queue=q},each:function(q){c.each(this.config.queue,function(r,s){if(s.__status===f.nodeStatus.destroy){return true}if(q(r,s)===false){return false}})},length:function(){return this.config.queue.length},_runtime:function(){var q=new Date().getTime(),r=this;c.each(this.config.queue,function(s,t){if(r._isNodeTimeout(t,q)){r.destroy(t)}r.heart(t,{ntime:q})});return this.config.listenStatus===f.listenStatus.live},_startListen:function(){var r=this,q=function(){r.config.listenStatus=f.listenStatus.live;c.Interval(e.proxy(r._runtime,r),r.config.runtimeStep,true)};if(this.config.listenStatus===f.listenStatus.live){this._stopListen();setTimeout(q,this.config.runtimeStep)}else{q()}},_stopListen:function(){this.config.listenStatus=f.listenStatus.die},_execNodeBehavior:function(t,s,q,u){var r=t[s];if(!t||!e.isFunction(r)){return}if(t.scope){return r.call(t.scope,q,u)}return r(q,u)},_isNodeTimeout:function(q,r){if(!q.timeout){return false}return r-q.createTime>=q.timeout},_getNodeId:function(q){return typeof q==="string"?q:q.id}});m={queue:[],cache:{},isRunling:false,reg:function(q,r){m.cache[q]=r},use:function(q,s){var r=m.cache[q];if(!r){return}if("function"===typeof r){return r(s)}else{return r}},run:function(q){if(arguments.length===0){return m.isRunling}m.isRunling=q===true?true:false},push:function(q){m.queue.push(q)},next:function(r,q){if(r){return this.query(r,q)}return m.queue.shift()},hasNext:function(r,q){if(r){return this.query(r,q)}return m.queue.length>0},query:function(A,x){var s,y,B,v=0,t=m.queue.length,r=A.split("."),u=0,z=r.length,w=[];for(;v<t;v++){s=m.queue[v];for(u=0;u<z;u++){s=s[r[u]];if(!s){break}}if(u===z&&s===x){y=v;B=m.queue[v];for(v=0;v<t;v++){if(v!==y){w.push(m.queue[v])}}m.queue=w;break}}return B}};var d=null,h=function(q){this.init(q)},l={target:"#chatdiv",cssbox:"#chat_lines",maxbatter:9999};h.create=function(q){return new h(q)};e.extend(true,h.prototype,{init:function(q){this.config=e.extend(true,l,q,{giftNameMap:{1:"100鱼丸",2:"520",3:"赞",4:"666",5:"飞机",6:"火箭",8:"初级酬勤",9:"中级酬勤",10:"高级酬勤"},autoAdd:true});this.render();this.bindEvt()},render:function(){this.$batter1=e('<div class="giftbatter-box giftbatter-box1"></div>');this.$batter2=e('<div class="giftbatter-box giftbatter-box2"></div>');this.$batter2.css({top:e("#js_chat_mem").outerHeight(true)+e("#cq_fans").outerHeight()});this.$cssbox=e(this.config.cssbox);this.$target=e(this.config.target);this.$target.append(this.$batter1);this.$target.append(this.$batter2)},target:function(q){if(q){this.$target=e(q);this.$target.append(this.$batter1);this.$target.append(this.$batter2)}else{return this.$target}},cssbox:function(q){if(q){this.$cssbox=e(q)}else{return this.$cssbox}},autoAdd:function(q){this.config.autoAdd=q===true?true:false},add:function(u){if(!this.config.autoAdd){return}var s,q,r=this;p.each(function(x,y){if(y.TYPE===f.nodeType.gift&&u.viewc.name===y.viewc.name&&u.viewc.style===y.viewc.style){s=y;return false}});if(s){if(u.viewc.effect===1){u.peckc.id=k._nextId();var w=this.$batter2.find(".giftbatter-item-right");var v=typeof u.__renderCallback==="function"?u.__renderCallback:function(){};if(w.length>1){s.view.css("top",20);this.$batter2.prepend(s.view);var t=s.view.outerHeight(true);w.not(s.view).each(function(x){e(this).animate({top:20+(t+20)*(x+1)},300)})}m.use("peckDown",{node:u.peckc});v()}q=this.findRes(s.type);s=e.extend(true,s,u,q,{createTime:new Date().getTime()+300,scope:this});p.update(s)}else{s=this._makeNode(u);if(s.viewc.effect===1){this.$batter2.append(s.view);var v=typeof s.__renderCallback==="function"?s.__renderCallback:function(){};s.view.css("top",(this.$cssbox.height()-s.view.height())/2).animate({left:0},300,function(){setTimeout(function(){s.view.animate({top:20},1000,function(){r.$batter2.prepend(s.view);var y=r.$batter2.find(".giftbatter-item-right");if(y.length>1){var x=s.view.outerHeight(true);y.not(s.view).each(function(z){e(this).animate({top:20+(x+20)*(z+1)},300)});s.createTime=new Date().getTime()+300*y.length}else{s.createTime=new Date().getTime()}p.add(s);m.use("peckDown",{node:s.peckc});v()})},200)})}else{this.$batter1.append(s.view);p.add(s)}}this.overflow()},remove:function(q){p.remove(q)},bindEvt:function(){var q=this;e(window).resize(function(){q.overflow();q.relayout()})},overflow:function(){var r=0,q=this.$cssbox.height();this.$batter2.find(".giftbatter-item-right").each(function(s){r+=e(this).outerHeight(true)+25});this.$batter2.css({height:r>q?q:"auto",overflow:r>q?"hidden":"visible"})},relayout:function(){if(!this.$batter1.find(".giftbatter-item").length){this.$batter1.hide();return}if(this.$cssbox.length){this.$batter1.css({"max-height":this.$cssbox.height()})}this.$batter1.show();this.$batter1.css("top",(this.$target.height()+e("#js_chat_mem").outerHeight(true)-this.$batter1.height())/2);this.$batter1.scrollTop(this.$batter1.get(0).scrollHeight)},findRes:function(r){var q=this.config.resource[r];if(q){return{viewc:{gift:q.name,back:q.bimg,head:q.himg,effect:q.ef},timeout:q.stay_time}}return{}},_nextId:function(){return"gift-node-"+p.length()+"-"+new Date().getTime()},_makeNode:function(s){var r={id:this._nextId(),type:s.type,render:e.proxy(this._nodeRender,this),destroy:e.proxy(this._nodeDestroy,this),scope:this},q=this.findRes(r.type);r=e.extend(true,{},r,s,q);r.view=this._makeNodeView(r);return r},_makeNodeView:function(t){var u,s,r,q;t.viewc.clsIdx=this._getNodeClassIndex(t);t.viewc.gift=t.viewc.gift?t.viewc.gift:this._getNodeGiftName(t);t.viewc.countstrs=String(t.viewc.count).split("");t.viewc.dire=t.viewc.effect===1?"right":"left";u=['<div data-id="<%=id%>" class="giftbatter-item giftbatter-item-<%=item.dire%> item-<%=item.clsIdx%>" data-user="<%=item.name%>" data-clsidx="<%=item.clsIdx%>">','<div class="item-back item-back-<%=item.clsIdx%>"><img src="<%=item.back%>" /></div>',"<% if (item.head) { %>",'<div class="item-head item-head-<%=item.clsIdx%>"><img src="<%=item.head%>" /></div>',"<% } %>",'<div class="item-name item-name-<%=item.clsIdx%>" title="<%=item.name%>"><%=item.name%></div>','<div class="item-gift item-gift-<%=item.clsIdx%> clearfix"><span class="fl">送出</span><span class="<%=item.clsIdx === 2 ? "gname" : ""%> fr"><%=item.gift%></span></div>','<div class="item-bat item-bat-<%=item.clsIdx%>"></div>','<div class="item-count item-count-<%=item.clsIdx%> clearfix">','<div class="nbox">',"<% for(var j=0; j<item.countstrs.length; j++) { %>","<% var str = item.countstrs[j]; %>",'<span class="n n<%=str%>"></span>',"<% } %>","</div>","</div>","</div>"].join("");s=g.template(u);r=s({id:t.id,item:t.viewc});q=e(r);return q},_makeNodeContentHtml:function(s){var t,r,q;s.viewc.clsIdx=this._getNodeClassIndex(s);s.viewc.gift=s.viewc.gift?s.viewc.gift:this._getNodeGiftName(s);s.viewc.countstrs=String(s.viewc.count).split("");t=['<div class="item-back item-back-<%=item.clsIdx%>"><img src="<%=item.back%>" /></div>',"<% if (item.head) { %>",'<div class="item-head item-head-<%=item.clsIdx%>"><img src="<%=item.head%>" /></div>',"<% } %>",'<div class="item-name item-name-<%=item.clsIdx%>" title="<%=item.name%>"><%=item.name%></div>','<div class="item-gift item-gift-<%=item.clsIdx%> clearfix"><span class="fl">送出</span><span class="<%=item.clsIdx === 2 ? "gname" : ""%> fr"><%=item.gift%></span></div>','<div class="item-bat item-bat-<%=item.clsIdx%>"></div>','<div class="item-count item-count-<%=item.clsIdx%> clearfix">','<div class="nbox">',"<% for(var j=0; j<item.countstrs.length; j++) { %>","<% var str = item.countstrs[j]; %>",'<span class="n n<%=str%>"></span>',"<% } %>","</div>","</div>"].join("");r=g.template(t);q=r({item:s.viewc});return q},_nodeRender:function(q){var r=this;if(q.status===f.nodeStatus.birth){if(q.node.viewc.effect!==1){q.node.view.animate({left:0},300);this.relayout()}this._nodeRenderFX(q);return true}if(q.status===f.nodeStatus.render){this._nodeReRender(q);if(q.node.viewc.effect!==1){this.relayout()}this._nodeRenderFX(q);return true}return false},_nodeReRender:function(s){var q=s.node.view.data("clsidx"),t=this._getNodeClassIndex(s.node),r=this._makeNodeContentHtml(s.node);s.node.view.removeClass("item-"+q).addClass("item-"+t).data("clsidx",t);s.node.view.html(r)},_nodeRenderFX:function(t){if(n.isIE){var s=t.node.view.find(".item-count .nbox"),u=parseInt(s.css("right"))||0,v=u-10,w=parseInt(s.css("bottom"))||0,x=w+10;if(n.isIE7){v=u-20;x=w+10}s.css({zoom:1.3,bottom:x,right:v}).animate({zoom:1,bottom:w,right:u},300,function(){e(this).removeAttr("style")})}else{var s=t.node.view.find(".item-count .nbox"),u=parseInt(s.css("right"))||0,v=u-22,w=parseInt(s.css("bottom"))||0,x=w+2,r=1.3,q=1;if(n.isFF){r=1.1;x=w+10;v=u-10}s.css({zoom:r,"-moz-transform":"scale("+r+")",bottom:x,right:v}).animate({zoom:q,"-moz-transform":"scale("+q+")",bottom:w,right:u},300,function(){e(this).removeAttr("style")})}},_nodeDestroy:function(q,r){if(location.href.indexOf("GIFTBATTER_DEBUG=true")>0){return}var s=this;this.$target.find(".giftbatter-item[data-id="+q.node.id+"]").animate({left:this.$target.outerWidth()},300,function(){e(this).remove();s.relayout();s.overflow();e.isFunction(r)&&r()})},_getNodeId:function(q){return typeof q==="string"?q:q.id},_getNodeClassIndex:function(q){return q.viewc.style},_getNodeGiftName:function(r){var q=this._getNodeClassIndex(r);return this.config.giftNameMap[q]}});var k=null,o=function(q){this.init(q)},b={target:"#chatdiv",cssbox:".chat_cont"};o.create=function(q){return new o(q)};e.extend(true,o.prototype,{init:function(q){this.config=e.extend(true,b,q,{cookieName:"peck_ids",isShow:false,isGet:true});this.render();this.bindEvt()},render:function(){var q='<div class="peck peck-loading" id="right_col_peck"><div class="peck-num"><span>x</span><strong class="peck-number"></strong><i></i></div><div class="peck-status"><div class="peck-cd"></div><div class="peck-cdn">loading...</div></div><div class="peck-tip"><div><span><img class="peck-img" src="'+$SYS.avatar_url+'avatar.php?size=small" /></span><strong class="peck-uname"></strong></div><p class="peck-tip-status"></p><i class="peck-tip-arrow"></i></div></div>';this.$peck=e(q);this.$target=e(this.config.target);this.$cssbox=e(this.config.cssbox);this.$target.append(this.$peck)},target:function(q){if(q){this.$target=e(q);this.$target.append(this.$peck)}else{return this.$target}},cssbox:function(q){if(q){this.$cssbox=e(q)}else{return this.$cssbox}},add:function(v){var z=e.isArray(v)?v:[v],B=[],x=z.length,w=get_cookie(this.config.cookieName),q=w?w.split(","):[],r=q.length,y=true;for(var u=0;u<x;u++){y=true;for(var t=0;t<r;t++){if(z[u].pid==q[t]){y=false;break}}if(y){B.push(z[u])}}var s;for(var u=0,A=B.length;u<A;u++){s=this.makeNode(B[u]);p.add(s)}this.toggle()},isShow:function(){return this.config.isShow},isGet:function(){return this.config.isGet},show:function(){this.config.isShow=true;this.$peck.css({top:this.$cssbox.outerHeight(true)-this.$peck.height()-20});this.$peck.fadeIn("fast")},hide:function(){this.config.isShow=false;this.$peck.fadeOut("slow")},toggle:function(){var q=this.getSource();if(q.length){this.show();this.changeView(q)}else{this.hide()}},save:function(r){var q=get_cookie(this.config.cookieName);if(q&&(q.indexOf(r)>=0)){return}q=q===null?"":q;q+=r+",";setCookie(this.config.cookieName,q,1800)},getSource:function(){var q=[];p.each(function(r,s){if(s.TYPE===f.nodeType.peck){q.push(s)}});return q},getLastDelayTime:function(){var q=this.getSource();if(q.length){return q[q.length-1].delayTime}return 0},changeView:function(t){var s=t[0],q=t.length,r=this.$peck.find(".peck-num"),u=this;this.config.currentPid=s.pid;this.$peck.data("switch",true).data("pid",s.pid).removeClass("peck-open").addClass("peck-loading").find(".peck-cdn").text("loading...");r[q>1?"show":"hide"]().css({"margin-left":-(r.outerWidth()/2)}).find(".peck-number").text(q);this.$peck.find(".peck-img").attr("src",s.uhead);this.$peck.find(".peck-uname").text(s.uname).attr("title",s.uname);if(this.$peck.hasClass("peck-loading")){this.$peck.find(".peck-cd").stop(true,true).css("width",0).animate({width:"100%"},s.delayTime,function(){u.$peck.removeClass("peck-loading").addClass("peck-close")})}this.$peck.find(".peck-tip").css({width:190,height:80});this.$peck.find(".peck-tip-status").html("领取未开始，请您耐心等待<br/>多发送弹幕可提升领取几率哦~");if(s.start>0){this.config.isGet=true}else{this.config.isGet=false}},bindEvt:function(){var q=this.$peck.find(".peck-tip");this.$peck.on("mouseenter",function(){q.stop(true,true).fadeIn(400)}).on("mouseleave",function(){q.stop(true,true).fadeOut(400)})},makeNode:function(q){q=e.extend({},q,{TYPE:f.nodeType.peck,id:this._nextId(),ctime:new Date().getTime(),heart:e.proxy(this._nodeHeart,this),destroy:e.proxy(this._nodeDestroy,this)});return q},_nextId:function(){return"peck-node-"+p.length()+"-"+new Date().getTime()},_nodeHeart:function(r){var q=this.getSource().length,s=this.$peck.find(".peck-num");s[q>1?"show":"hide"]().css({"margin-left":-(s.outerWidth()/2)}).find(".peck-number").text(q);this.$peck.css({top:this.$cssbox.outerHeight(true)-this.$peck.height()-20});if(this.$peck.hasClass("peck-loading")){return}if(r.node.pid!==this.config.currentPid){return}this.$peck.data("pid",r.node.pid);var u=r.now.ntime-r.node.createTime;if(u<=r.node.start){var t=this._timeFormat(r.node.start-u);this.$peck.find(".peck-cdn").text(t)}else{if(u>r.node.start){this.$peck.removeClass("peck-close").addClass("peck-open").find(".peck-cdn").text("领取");this.$peck.find(".peck-tip").css({width:160,height:60});this.$peck.find(".peck-tip-status").html("神秘宝箱已开启，手慢无！~")}}},randomTime:function(){return(Math.floor(Math.random()*9+0)+1)*1000},_nodeDestroy:function(q,r){e.isFunction(r)&&r();this.toggle()},_timeFormat:function(t){var q,r;if(t>60000){q=String(parseInt(t/60000));r=String(parseInt(t%60000/1000))}else{q="00";r=String(parseInt(t/1000))}q=q.length>1?q:"0"+q;r=r.length>1?r:"0"+r;return q+":"+r}});j=function(){if(!a.giftBatterConfig){a.console&&console.info("[礼物系统]\n配置丢失，初始化失败。");return}var q=e("#blackgift");var s=new Date().getTime();var r=e.extend(giftBatterConfig,{"cq-1":{bimg:$SYS.res_url+"douyu/images/giftbatter/chouqin_1.gif?v=1446174322131",himg:"",stay_time:10000},"cq-2":{bimg:$SYS.res_url+"douyu/images/giftbatter/chouqin_2.gif?v=1446174322131",himg:"",stay_time:20000},"cq-3":{bimg:$SYS.res_url+"douyu/images/giftbatter/chouqin_3.gif?v=1446174322131",himg:"",stay_time:30000},older100Balls:{bimg:$SYS.res_url+"douyu/images/giftbatter/mobile-bg-100.png?v=1446174322131",himg:$SYS.res_url+"douyu/images/giftbatter/mobile-head-100.png?v=1446174322131",stay_time:1000}});m.reg("planeSmall",function(y){var t,v=e('.lw_item[data-giftid="'+y.node.type+'"]'),x=v.offset(),w={w:40,h:25},u={x:(v.width()-w.w)/2+x.left+2,y:x.top-w.h};t=e('<div class="gift-smallPlane"></div>').css({left:u.x,top:u.y});e("body").append(t);t.animate({top:u.y/4,left:-w.w*2},2000,"easeOutCubic",function(){m.use("planeBig",y);e(this).remove()})});m.reg("planeBig",function(x){var u,t=d.target(),w={w:91,h:50},v={x:t.width()-20,y:(t.height()-w.h)/2};u=e('<div class="gift-bigPlane"></div>').css({left:v.x,top:v.y});t.append(u);u.animate({left:-w.w},3000,function(){e(this).remove();d.add(x.node)})});m.reg("rocketSmall",function(y){var v,w=e('.lw_item[data-giftid="'+y.node.type+'"]'),x=w.offset(),u={w:30,h:105},t={x:(w.width()-u.w)/2+x.left+2,y:x.top-u.h};v=e('<div class="gift-small-rocket"></div>').css({left:t.x,top:t.y});e("body").append(v);v.animate({top:-u.h*2},1500,"swing",function(){m.use("rocketBig",y);d.autoAdd(false);e(this).remove()})});m.reg("rocketBig",function(z){if(m.run()){m.push(z);return}m.run(true);var t,v,C,w,E,A=k.target(),x=e('<div class="rocket"></div>'),y=e(".giftbatter-box1"),u=e('<div class="rocket-info"><div><strong>'+z.node.viewc.name+"</strong></div><span>为主播发射了一枚火箭</span></div>"),B={w:100,h:350},F={w:307,h:357},D={x:(x.width()-B.w)/2,y:x.height()-20};A.append(x);x.css({width:A.width(),height:k.cssbox().outerHeight(true)-x.height(),position:"absolute",top:0,left:0,"z-index":198,overflow:"hidden"});t=['<div class="gift-big-rocket"></div>','<div class="gift-frog">','<object type="application/x-shockwave-flash" ','id="giftBatterFrog" ','name="giftBatterFrog" ','align="middle" ','allowscriptaccess="always" ','allowfullscreen="true" ','allowfullscreeninteractive="true" ','data="<%=frogurl%>" ','width="100%" ','height="100%">','<param name="src" value="<%=frogurl%>">','<param name="quality" value="high">','<param name="bgcolor" value="#fff">','<param name="allowscriptaccess" value="always">','<param name="allowfullscreen" value="true">','<param name="wmode" value="transparent">','<param name="allowFullScreenInteractive" value="true">','<param name="flashvars" value="">',"</object>","</div>"].join("");v=g.template(t);C=v({frogurl:$SYS.res_url+"/douyu/images/giftbatter/frog.swf"});x.append(C);x.append(u);w=x.find(".gift-big-rocket");E=x.find(".gift-frog");w.css({top:x.height(),left:(x.width()-w.width())/2});E.css({bottom:0});u.css({left:10,top:x.height()-u.height()}).fadeIn(800);w.animate({top:x.height()-B.h},{duration:1000,easing:"easeOutCirc",step:function(I,K){var L,M=y.position(),J=y.height(),G=parseInt(w.css("top"),10);if(M&&G<=M.top+J){L=G-J;y.css("top",G-J)}},complete:function(){var G=z.node;y.stop(true,true);setTimeout(function(){setTimeout(function(){E.remove();u.fadeOut(400,function(){e(this).remove()})},500);w.animate({top:-B.h},{duration:1000,easing:"easeInExpo",step:function(J,L){var M=y.position(),K=y.height(),I=parseInt(w.css("top"),10);if(M&&I<=M.top+K){y.css("top",I-K)}},complete:function(){var H=[];G.__renderCallback=function(){m.run(false);var I;if((I=m.hasNext("node.viewc.effect",1))){m.use("rocketBig",I)}};y.stop(true,true).removeAttr("style").html("");e(this).parent().remove();p.each(function(I,J){if(J.TYPE===f.nodeType.gift&&J.viewc.effect!==1){H.push(J)}});p.clear(H);d.autoAdd(true);d.add(G)}})},1000)}})});m.reg("peckDown",function(x){function u(y){if(k.getSource().length){p.add(k.makeNode(y))}else{k.add(y)}}var w=x.node;w.createTime=new Date().getTime();if(!k.isShow()){var v=e('<div class="peck"></div>'),t=k.target();t.append(v);v.show().css({top:0}).animate({top:k.$cssbox.outerHeight(true)-k.$peck.height()-20},1000,function(){e(this).remove();u(w)})}else{u(w)}});p=p.create({autoStartListen:true});d=new h({resource:r});k=new o();a.GiftBatterProxy={set:function(t,u){if("target"===t){d.target(u)}else{if("cssbox"===t){d.cssbox(u)}else{if("data"===t){d.add(u)}}}}};a.GiftPeckProxy={set:function(t,u){if("target"===t){k.target(u)}else{if("cssbox"===t){k.cssbox(u)}else{if("data"===t){k.add(u)}}}}};a.live_gift_batter=function(w){a.sendGiftNewReturn&&a.sendGiftNewReturn(w,r);var x,A=c.readData(w);if(A.type==="dgn"){x={TYPE:f.nodeType.gift,type:parseInt(A.gfid,10),createTime:new Date().getTime()+600,viewc:{count:A.hits?parseInt(A.hits,10):0,lcount:A.lhits?parseInt(A.lhits,10):0,name:A.src_ncnm,style:A.gs?parseInt(A.gs,10):0}};x.viewc.effect=r[x.type].ef;if(x.viewc.count<=1&&x.viewc.style===1){return}var D=window.shieGift.giftEffect(A.sid);if(!D){if(x.viewc.effect===0){GiftBatterProxy.set("data",x)}else{if(x.viewc.effect===2){m.use($SYS.uid===A.sid?"planeSmall":"planeBig",{node:x})}else{if(x.viewc.effect===1){x.peckc={TYPE:f.nodeType.peck,createTime:new Date().getTime(),pid:A.rpid!==undefined?parseInt(A.rpid,10):0,start:A.slt!==undefined?parseInt(A.slt,10):0,end:A.elt!==undefined?parseInt(A.elt,10):0,delayTime:k.randomTime(),uid:A.sid,uname:A.src_ncnm,uhead:$SYS.avatar_url+"avatar.php?uid="+A.sid+"&size=small"};x.peckc.start=x.peckc.start*1000;x.peckc.end=x.peckc.end*1000;x.peckc.timeout=x.peckc.end+k.getLastDelayTime();m.use($SYS.uid===A.sid?"rocketSmall":"rocketBig",{node:x})}}}}}if(A.type==="memberinfores"){if(A.list==""){return}var t=[],C=A.list.split("/|/"),v=C.length;for(var B=0;B<v;B++){if(C[B]==""){continue}var F=c.readData(C[B]),z={};z={TYPE:f.nodeType.peck,createTime:new Date().getTime(),pid:F.rpid!==undefined?parseInt(F.rpid,10):0,start:F.stl!==undefined?parseInt(F.stl,10):0,end:F.etl!==undefined?parseInt(F.etl,10):0,delayTime:k.randomTime(),uid:F.sid,uname:F.snk,uhead:$SYS.avatar_url+"avatar.php?uid="+F.sid+"&size=small"};z.start=z.start*1000;z.end=z.end*1000;z.timeout=z.end;t.push(z);if(B>0){t[B].timeout=t[B].timeout+t[B-1].delayTime}}t.sort(function(H,G){return H.start>G.start?1:-1});k.add(t)}if(A.type==="ggbr"){var u=k.target(),y=e('<div class="peck-back-tip"></div>'),E=e("#right_col_peck").position();u.append(y);if(A.sl>0){y.addClass("peck-back-success").html('<p><span>恭喜您，领取了</span><strong title="'+A.snk+'">'+A.snk+"</strong></p><p><span>派送的</span><strong>"+A.sl+"个鱼丸</strong><span>~</span></p>");e("#ywtit").html("鱼丸 "+number_format(A.sb)).data("value",number_format(A.sb))}else{y.addClass("peck-back-error").html("<p><span>"+(k.isGet()?"手慢了，没抢到T_T":"运气不佳，您没有领到宝箱礼物")+"</span></p>")}y.css({top:E.top-y.height()-10,"margin-left":-(y.width()/2)}).fadeIn(400,function(){k.save(A.rpid);var G;p.each(function(H,I){if(I.TYPE===f.nodeType.peck&&I.pid==A.rpid){G=I}});if(G){p.destroy(G)}}).delay(3000).fadeOut(400);e(window).resize(function(){y.css({top:E.top-y.height()-10,"margin-left":-(y.width()/2)})})}};a.live_gift_batter_cq=function(z){try{a.sendCQNewReturn&&a.sendCQNewReturn(z,r)}catch(A){}var y=c.readData(z),t=c.readData(y.sui),v=0,u=0;switch(y.lev){case"1":v="cq-1";u=8;break;case"2":v="cq-2";u=9;break;case"3":v="cq-3";u=10;break}var w={TYPE:f.nodeType.gift,type:v,createTime:new Date().getTime(),viewc:{count:y.hits?parseInt(y.hits,10):0,lcount:y.lhits?parseInt(y.lhits,10):0,name:t.nick,style:u}};var x=window.shieGift.giftEffect(y.sid);if(!x){GiftBatterProxy.set("data",w)}};a.live_gift_batter_mobile=function(x){var w=c.readData(x),t=c.readData(w.sui),u;if(w.type==="donateres"&&w.r==="0"){u={TYPE:f.nodeType.gift,type:"older100Balls",createTime:new Date().getTime(),viewc:{count:w.hc?parseInt(w.hc,10):0,name:t.nick,style:1}};if(u.viewc.count<=1&&u.viewc.style===1){return}var v=window.shieGift.giftEffect(t.id);if(!v){GiftBatterProxy.set("data",u)}}}};e(j)})(window,window.jQuery,window.Helper);